<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FreeRealm</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Arial', sans-serif; }
    body { background: #1b2838; color: #c6d4df; min-height: 100vh; display: flex; flex-direction: column; align-items: flex-start; padding-left: 0px; }
    .header { background: #171a21; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.5); width: 100%; position: fixed; top: 0; left: 0; right: 0; z-index: 10; }
    .logo-container { display: flex; flex-direction: column; max-width: 100%; }
    .logo { font-size: 24px; font-weight: bold; color: #fff; text-decoration: none; display: flex; align-items: center; }
    .logo span { color: #66c0f4; }
    .current-url { font-size: 12px; color: #8f98a0; margin-top: 2px; word-break: break-word; max-width: 100%; }
    .nav { display: flex; gap: 20px; justify-content: flex-end; width: 100%; }
    .nav a { color: #c6d4df; text-decoration: none; font-size: 14px; margin-top: 5px; }
    .nav a:hover { color: #66c0f4; }
    .game-page { padding: 20px; width: 100%; max-width: 1100px; margin-top: 120px; }
    .game-header { display: flex; flex-direction: column; gap: 20px; margin-bottom: 20px; align-items: flex-start; }
    .game-logo { width: 300px; border-radius: 8px; }
    .game-details { text-align: left; max-width: 600px; }
    .game-name { font-size: 24px; color: #c6d4df; margin-bottom: 10px; }
    .game-description { color: #c6d4df; margin-bottom: 20px; line-height: 1.5; }
    .download-btn { background: #a1cd44; color: #1b2838; border: none; border-radius: 3px; padding: 10px 20px; font-size: 16px; cursor: pointer; text-decoration: none; display: inline-block; font-weight: bold; margin-bottom: 10px; }
    .download-btn:hover { background: #8cb63b; }
    .rus-btn { background: #66c0f4; color: #1b2838; border: none; border-radius: 3px; padding: 10px 20px; font-size: 16px; cursor: pointer; text-decoration: none; display: inline-block; font-weight: bold; }
    .rus-btn:hover { background: #4ba3d5; }
    .back-btn { color: #66c0f4; text-decoration: none; display: inline-block; margin-top: 20px; }
    .progress-container { margin-top: 20px; display: none; }
    .progress-bar { width: 100%; height: 10px; background-color: #f1f1f1; border-radius: 5px; overflow: hidden; }
    .progress-bar span { display: block; height: 100%; background-color: #66c0f4; width: 0; }

    .comment-section { margin-top: 40px; width: 100%; max-width: 600px; }
    .comment-section h3 { margin-bottom: 10px; }
    .comment-item { background: #171a21; padding: 10px; border-radius: 5px; margin-bottom: 10px; word-break: break-word; }
    .comment-item strong { color: #66c0f4; }
    .comment-form input, .comment-form textarea { background: #1b2838; color: #c6d4df; border: 1px solid #8f98a0; border-radius: 3px; padding: 5px; margin-bottom: 10px; }
    .comment-form input { width: 200px; }
    .comment-form textarea { width: 100%; height: 60px; resize: none; }
    .comment-form button { margin-top: 5px; }

    @media (max-width: 600px) {
      .header { flex-direction: column; align-items: flex-start; }
      .nav { justify-content: flex-start; width: 100%; margin-top: 10px; }
      .nav a { margin: 5px 10px 0 0; }
      .game-header { flex-direction: column; }
      .game-details { text-align: left; }
    }
    footer { width: 100%; text-align: center; margin-top: auto; padding: 20px 0; color: #8f98a0; font-size: 14px; }
  </style>
</head>
<body>
  <div class="header">
    <div class="logo-container">
      <a href="./" class="logo">Free<span>Realm</span>Hub</a>
      <div class="current-url" id="current-url"></div>
    </div>
    <div class="nav">
      <a href="https://www.donationalerts.com/r/morozikdurov" target="_blank">Донат</a>
      <a href="https://t.me/freerealmhub" target="_blank">Сообщество</a>
    </div>
  </div>

  <div class="game-page">
    <div class="game-header">
      <img src="https://raw.githubusercontent.com/freerealm/freerealm/main/delta.png"
           alt="DELTARUNE Logo"
           class="game-logo"
           onerror="this.src='https://via.placeholder.com/200x200?text=DELTARUNE';">
      <div class="game-details">
        <h1 class="game-name">DELTARUNE 1-4 Ch</h1>
        <p class="game-description">
Deltarune (стилизовано DELTARUNE и deltarune) — ролевая игра, разрабатываемая Тоби Фоксом и его командой и являющаяся его второй полноценной игрой.
        </p>
        <p class="game-description"><strong>Автор: TobyFox</strong></p>
        <a href="https://www.dropbox.com/scl/fi/lw40d2dori9i9j5x8y3li/DELTARUNE.zip?rlkey=xdsaybxxtg00alunx9yj7k26q&st=v648qkuu&dl=1"
           class="download-btn" target="_blank">Скачать ZIP</a><br>
        <a href="https://www.dropbox.com/scl/fi/sytukfvvad7nih30z45ir/DELTARUNERUS.zip?rlkey=bn930szfo1tlfotvfuyzxug09&st=31gc0uon&dl=1"
           class="rus-btn" target="_blank">Русская версия</a><br>
        <a href="index.html" class="back-btn">← Вернуться к списку игр</a>

        <div class="progress-container" id="progress-container">
          <p>Загрузка в процессе...</p>
          <div class="progress-bar"><span></span></div>
        </div>
      </div>
    </div>

    <div class="comment-section">
      <h3>Отзывы игроков</h3>
      <form id="comment-form" class="comment-form">
        <input type="text" id="username" placeholder="Ваш ник" required>
        <textarea id="comment" placeholder="Ваш комментарий (не более 300 символов)" maxlength="300" required></textarea>
        <button type="submit" class="download-btn">Отправить</button>
      </form>
      <div id="comment-response" style="margin-top:10px; color:#66c0f4;"></div>
      <div id="comments-list" style="margin-top:20px;"></div>
    </div>

  </div>

  <footer>
    <div class="footer-text">FreeRealmHub 2025</div>
  </footer>

  <script>
    document.getElementById('current-url').textContent = window.location.href;

    const commentsList = document.getElementById('comments-list');
    const endpoint = 'http://147.185.221.211:7700/deltarune'; // Уникальный эндпоинт для DELTARUNE

    async function loadComments() {
      try {
        const response = await fetch(endpoint);
        if (response.ok) {
          const comments = await response.json();
          commentsList.innerHTML = '';
          comments.forEach(c => {
            const div = document.createElement('div');
            div.className = 'comment-item';
            div.innerHTML = `<strong>${c.username}:</strong> ${c.comment}`;
            commentsList.appendChild(div);
          });
        }
      } catch (err) {
        console.error('Не удалось загрузить комментарии', err);
      }
    }

    document.getElementById('comment-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      const username = document.getElementById('username').value.trim();
      const comment = document.getElementById('comment').value.trim();

      if (!username || !comment) {
        alert('Заполните ник и комментарий');
        return;
      }

      // Ник: только буквы, цифры и пробелы
      const usernamePattern = /^[a-zA-Z0-9а-яА-ЯёЁ\s]+$/;
      if (!usernamePattern.test(username)) {
        alert('Ник может содержать только буквы и цифры');
        return;
      }

      // Комментарий: буквы, цифры, пробелы и стандартные знаки препинания
      const commentPattern = /^[a-zA-Z0-9а-яА-ЯёЁ\s.,!?(){}\[\]:;"'`-]+$/;
      if (!commentPattern.test(comment)) {
        alert('Комментарий содержит недопустимые символы');
        return;
      }

      if (comment.length > 300) {
        alert('Комментарий не должен превышать 300 символов');
        return;
      }

      try {
        const response = await fetch(endpoint, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, comment })
        });

        if (response.ok) {
          document.getElementById('comment-response').textContent = 'Комментарий отправлен!';
          document.getElementById('comment-form').reset();
          loadComments();
        } else {
          document.getElementById('comment-response').textContent = 'Ошибка при отправке.';
        }
      } catch (err) {
        document.getElementById('comment-response').textContent = 'Сервер недоступен.';
        console.error(err);
      }
    });

    loadComments();
  </script>
</body>
</html>
